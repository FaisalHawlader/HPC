<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>/mw-c-api/binaries/src/mwconfig.c</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="yogoko.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="https://www.yogoko.com/"><img height="40px" src="yogoko-logo-svg-fr-white.png" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">YoGoKo Smart Middleware C/C++ API</span></p>
              <ul id="yogoko-navlist" class="nav navbar-nav"></ul>
              <form id="yogoko-searchform" class="navbar-form navbar-left navbar-right hidden-sm hidden-xs">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_2mw-c-api_2binaries_2src_2mwconfig_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/mw-c-api/binaries/src/mwconfig.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>A tool to perform start/stop/set/get configuration on middleware facilities try mwconfig -h</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="choir__client_8h.html">choir_client.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="choir__logger_8h.html">choir_logger.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span> <span class="comment">/* errno */</span></div><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#define BUFFER_LENGTH 16384</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> TAG[] = <span class="stringliteral">&quot;mwconfig&quot;</span>;</div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> keepRunning = 1;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> intHandler(<span class="keywordtype">int</span> dummy)</div><div class="line">{</div><div class="line">    (void)dummy;</div><div class="line">    keepRunning = 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#define BUFFER_LENGTH 16384</span></div><div class="line"><span class="preprocessor">#define DEFAULT_ENTRY_NUMBER 512</span></div><div class="line"><span class="preprocessor">#define DEFAULT_KEY_SIZE 512</span></div><div class="line"><span class="preprocessor">#define DEFAULT_VALUE_SIZE DEFAULT_KEY_SIZE</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> unescape(<span class="keywordtype">char</span>* dest, <span class="keywordtype">char</span>* source)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> i, j;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = j = 0; source[i] != <span class="charliteral">&#39;\0&#39;</span>; ++i)</div><div class="line">        <span class="keywordflow">switch</span> (source[i]) {</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div><div class="line">            <span class="keywordflow">switch</span> (source[++i]) {</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\a&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\b&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\f&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\r&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\t&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\v&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\\&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;\&#39;&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\&#39;&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\&quot;&#39;</span>;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                dest[j++] = <span class="charliteral">&#39;\\&#39;</span>;</div><div class="line">                dest[j++] = source[i];</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            dest[j++] = source[i];</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    dest[j] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> delete_spaces(<span class="keywordtype">char</span> dst[],<span class="keywordtype">char</span> src[])</div><div class="line">{</div><div class="line">    <span class="comment">// src is supposed to be zero ended</span></div><div class="line">    <span class="comment">// dst is supposed to be large enough to hold src</span></div><div class="line">    <span class="keywordtype">int</span> s, d = 0;</div><div class="line">    <span class="keywordflow">for</span> (s = 0; src[s] != 0; s++)</div><div class="line">        <span class="keywordflow">if</span> (src[s] != <span class="charliteral">&#39; &#39;</span>) {</div><div class="line">            dst[d] = src[s];</div><div class="line">            d++;</div><div class="line">        }</div><div class="line">    dst[d] = 0;</div><div class="line">}</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span>* extract_key(<span class="keywordtype">char</span>* line)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> *tmp;</div><div class="line">    <span class="keywordtype">char</span> *key, *offset;</div><div class="line">    <span class="keywordtype">size_t</span> key_len;</div><div class="line"></div><div class="line">    offset = strstr(line, (<span class="stringliteral">&quot;=&quot;</span>));</div><div class="line">    <span class="keywordflow">if</span> (offset == NULL) {</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line">    key_len = offset - line;</div><div class="line">    tmp = calloc(1, strlen(line));</div><div class="line">    <span class="keywordflow">if</span>(tmp == NULL){</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line">    key = calloc(1,key_len+1);</div><div class="line">    <span class="keywordflow">if</span> (key == NULL) {</div><div class="line">        free(tmp);</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line">    strncpy(tmp, line, key_len);</div><div class="line">    delete_spaces(key, tmp);</div><div class="line">    free(tmp);</div><div class="line">    <span class="keywordflow">return</span> key;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span>* extract_value(<span class="keywordtype">char</span>* line)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* offset;</div><div class="line">    <span class="keywordtype">char</span>* value;</div><div class="line">    <span class="keywordtype">char</span>* pos;</div><div class="line">    <span class="keywordtype">size_t</span> value_len;</div><div class="line">    offset = strstr(line, (<span class="stringliteral">&quot;=&quot;</span>));</div><div class="line">    offset += 1;</div><div class="line">    value_len = strlen(line) -(offset - line);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (; *offset == <span class="charliteral">&#39; &#39;</span>; offset++);</div><div class="line">    pos = strchr(offset, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line">    <span class="keywordflow">if</span> (pos != NULL) {</div><div class="line">        *pos = 0x0;</div><div class="line">    }</div><div class="line"></div><div class="line">    value = calloc(1,value_len);</div><div class="line">    <span class="keywordflow">if</span> (value == NULL) {</div><div class="line">        <span class="keywordflow">return</span> NULL;</div><div class="line">    }</div><div class="line">    <span class="comment">//unescape(value, offset);</span></div><div class="line">    memcpy(value,offset,value_len);</div><div class="line">    <span class="keywordflow">return</span> value;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> set_mib(choir_socket_handler_t* choir_handler, FILE* file</div><div class="line">        ,<span class="keywordtype">char</span> *service_name,uint16_t instance_id,uint8_t offline)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> buffer[BUFFER_LENGTH];</div><div class="line">    memset(buffer,0,BUFFER_LENGTH);</div><div class="line">    <span class="keyword">struct </span>choir_map* mib = <a name="a0"></a><a class="code" href="choir__client_8h.html#a65ec177b8f4734de0ebff688e748523b">choir_map_init</a>(DEFAULT_ENTRY_NUMBER);</div><div class="line">    <span class="keywordtype">char</span>** key_array = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*) * DEFAULT_ENTRY_NUMBER);</div><div class="line">    <span class="keywordtype">void</span>** value_array = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) * DEFAULT_ENTRY_NUMBER);</div><div class="line">    <span class="keywordtype">size_t</span> cur_size = DEFAULT_ENTRY_NUMBER;</div><div class="line">    <span class="keywordtype">int</span> n = 0;</div><div class="line">    <span class="keywordtype">size_t</span> entry_number = 0;</div><div class="line">    uint32_t i = 0;</div><div class="line">    <span class="keywordflow">while</span> (fgets((<span class="keywordtype">char</span> *)buffer, BUFFER_LENGTH, file)) {</div><div class="line">        <span class="keywordflow">if</span> (entry_number == cur_size) {</div><div class="line">            key_array = realloc(key_array, cur_size * 2);</div><div class="line">            value_array = realloc(value_array, cur_size * 2);</div><div class="line">            mib = <a name="a1"></a><a class="code" href="choir__client_8h.html#a2487f8a7b76f589986d0a06b0f745c0b">choir_map_expand</a>(mib, cur_size * 2);</div><div class="line">            cur_size = cur_size * 2;</div><div class="line">        }</div><div class="line"></div><div class="line">        key_array[entry_number] = extract_key(buffer);</div><div class="line">        <span class="keywordflow">if</span> (key_array[entry_number] == NULL) {</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line">        }</div><div class="line">        value_array[entry_number] = NULL;</div><div class="line">        <span class="keywordtype">char</span>* value = extract_value(buffer);</div><div class="line">        <span class="keywordflow">if</span> (value == NULL) {</div><div class="line">            <span class="keywordflow">goto</span> put_error;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (strcmp(value, <span class="stringliteral">&quot;null&quot;</span>) == 0) { <span class="comment">// Let&#39;s parse value</span></div><div class="line">            n = <a name="a2"></a><a class="code" href="choir__client_8h.html#a3535d561641c0e977214bcdd455c33bc">choir_map_put_null</a>(mib, key_array[entry_number]);</div><div class="line">            free(value);</div><div class="line">            <span class="keywordflow">if</span> (!n) {</div><div class="line">                <span class="keywordflow">goto</span> object_put_error;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(value, <span class="stringliteral">&quot;true&quot;</span>) == 0) {</div><div class="line">            n = <a name="a3"></a><a class="code" href="choir__client_8h.html#aa8708d8048129cc2f960f02b34c9fe1f">choir_map_put_bool</a>(mib, key_array[entry_number], <span class="keyword">true</span>);</div><div class="line">            free(value);</div><div class="line">            <span class="keywordflow">if</span> (!n) {</div><div class="line">                <span class="keywordflow">goto</span> object_put_error;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(value, <span class="stringliteral">&quot;false&quot;</span>) == 0) {</div><div class="line">            n = <a class="code" href="choir__client_8h.html#aa8708d8048129cc2f960f02b34c9fe1f">choir_map_put_bool</a>(mib, key_array[entry_number], <span class="keyword">false</span>);</div><div class="line">            free(value);</div><div class="line">            <span class="keywordflow">if</span> (!n) {</div><div class="line">                <span class="keywordflow">goto</span> object_put_error;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*value == <span class="charliteral">&#39;&quot;&#39;</span>) {</div><div class="line">            <span class="keywordflow">if</span> (value[strlen(value) - 1] == <span class="charliteral">&#39;&quot;&#39;</span>) { <span class="comment">// It&#39;s a string</span></div><div class="line">                value_array[entry_number] = value;</div><div class="line">                n = <a name="a4"></a><a class="code" href="choir__client_8h.html#a16ee0807704a769df7c2f2f0183492cc">choir_map_put_string</a>(mib, key_array[entry_number],</div><div class="line">                        (<span class="keywordtype">char</span>*)value_array[entry_number] + 1,</div><div class="line">                        strlen(value_array[entry_number]) - 2);</div><div class="line">                <span class="keywordflow">if</span> (!n) { <span class="comment">// Set value without double quote</span></div><div class="line">                    <span class="keywordflow">goto</span> object_put_error;</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                <span class="keywordflow">goto</span> put_error;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*value == <span class="charliteral">&#39;[&#39;</span> &amp;&amp; value[strlen(value) - 1] == <span class="charliteral">&#39;]&#39;</span>) { <span class="comment">// It&#39;s a binary array</span></div><div class="line">            uint8_t* val_bin;</div><div class="line">            value_array[entry_number] = malloc(<span class="keyword">sizeof</span>(uint8_t) * DEFAULT_VALUE_SIZE);</div><div class="line">            val_bin = value_array[entry_number];</div><div class="line">            memset(val_bin, 0x0, DEFAULT_VALUE_SIZE);</div><div class="line">            <span class="keywordtype">int</span> j = 0, u = 0;</div><div class="line">            <span class="keywordflow">for</span> (i = 1; i &lt; strlen(value); i++) {</div><div class="line">                <span class="keywordflow">if</span> (value[i] == <span class="charliteral">&#39;,&#39;</span>) {</div><div class="line">                    val_bin[j] = (uint8_t)strtoul(&amp;value[u + 1], NULL, 16);</div><div class="line">                    j++;</div><div class="line">                    u = i;</div><div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value[i] == <span class="charliteral">&#39;]&#39;</span>) {</div><div class="line">                    val_bin[j] = (uint8_t)strtoul(&amp;value[u + 1], NULL, 16);</div><div class="line">                    j++;</div><div class="line">                }</div><div class="line">            }</div><div class="line">            n = <a name="a5"></a><a class="code" href="choir__client_8h.html#a8c08ef65f75abef307dbabb30f15186b">choir_map_put_bin</a>(mib, key_array[entry_number], val_bin, j);</div><div class="line">            free(value);</div><div class="line">            <span class="keywordflow">if</span> (!n) {</div><div class="line">                <span class="keywordflow">goto</span> object_put_error;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isdigit(*value) || *value == <span class="charliteral">&#39;-&#39;</span>) { <span class="comment">// it&#39;s a digit value Integer or Double</span></div><div class="line">            <span class="keywordtype">char</span>* pos;</div><div class="line">            <span class="keywordtype">char</span> *end;</div><div class="line">            pos = strchr(value, <span class="charliteral">&#39;.&#39;</span>);</div><div class="line">            <span class="keywordflow">if</span> (pos != NULL) { <span class="comment">// It&#39;s a double value</span></div><div class="line">                <span class="keywordtype">double</span> double_value = strtod(value, &amp;end);</div><div class="line">                <span class="keywordflow">if</span> (*end){</div><div class="line">                    <span class="keywordflow">goto</span> put_error;</div><div class="line">                }</div><div class="line">                n = <a name="a6"></a><a class="code" href="choir__client_8h.html#a46c34660033c00962acd9ec63b0bf9e2">choir_map_put_double</a>(mib, key_array[entry_number], double_value);</div><div class="line">                free(value);</div><div class="line">                <span class="keywordflow">if</span> (!n) {</div><div class="line">                    <span class="keywordflow">goto</span> object_put_error;</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> { <span class="comment">// It&#39;s a int value</span></div><div class="line">                int64_t int_value = strtol(value, &amp;end, 10);</div><div class="line">                <span class="keywordflow">if</span> (*end){</div><div class="line">                    <span class="keywordflow">goto</span> put_error;</div><div class="line">                }</div><div class="line">                n = <a name="a7"></a><a class="code" href="choir__client_8h.html#a458fe5941e590d14abd50dde1c5dac9f">choir_map_put_int</a>(mib, key_array[entry_number], int_value);</div><div class="line">                free(value);</div><div class="line">                <span class="keywordflow">if</span> (!n) {</div><div class="line">                    <span class="keywordflow">goto</span> object_put_error;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            free(value);</div><div class="line">            <span class="keywordflow">goto</span> put_error;</div><div class="line">        }</div><div class="line">        memset(buffer, 0x0, BUFFER_LENGTH);</div><div class="line">        entry_number++;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (entry_number &gt; 0) {</div><div class="line">        <span class="keywordflow">if</span>(choir_mib_set(choir_handler, service_name, instance_id, offline, mib) != 0){</div><div class="line">            printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a name="a8"></a><a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">goto</span> free;</div><div class="line"></div><div class="line">object_put_error:</div><div class="line">    logError(TAG, <span class="stringliteral">&quot;Choir mib put error\n&quot;</span>);</div><div class="line">    <span class="keywordflow">goto</span> free;</div><div class="line"></div><div class="line">put_error:</div><div class="line">    logError(TAG, <span class="stringliteral">&quot;File parsing error\n&quot;</span>);</div><div class="line">free:</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt;= entry_number; i++) {</div><div class="line">        free(key_array[i]);</div><div class="line">        <span class="keywordflow">if</span> (value_array[i] != NULL) {</div><div class="line">            free(value_array[i]);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    free(key_array);</div><div class="line">    free(value_array);</div><div class="line">    <a name="a9"></a><a class="code" href="choir__client_8h.html#a46a1ae74e3f6a9a41da2690a6fc3ea62">choir_map_free</a>(mib);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ferror(file)) {</div><div class="line">        perror(<span class="stringliteral">&quot;Error reading from stdin.&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *config_status_to_str(uint8_t status)</div><div class="line">{</div><div class="line">    <span class="keywordflow">switch</span> (status) {</div><div class="line">    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_UNKNOWN:</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line">    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_STARTED:</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;started&quot;</span>;</div><div class="line">    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_STOPPED:</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;stopped&quot;</span>;</div><div class="line">    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_FAILED:</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;failed&quot;</span>;</div><div class="line">    <span class="keywordflow">default</span>:</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_help(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    printf(<span class="stringliteral">&quot;mwconfig - Configure middleware service \n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;Usage :\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;mwconfig list-services [OPTIONS]    List defined services in mw-server\n\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;mwconfig dump [OPTIONS]         Get all services status and current mibs\n\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;mwconfig mib [set|get|get-all|reset]  -t &lt;service_name&gt; [OPTIONS]\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    set [OPTIONS] key=value key2=value2 ...     Set specified configuration in mib\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    get [OPTIONS] key ...               Get specified mib entry\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    get-all [OPTIONS]               Get all mib\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    reset [OPTIONS]                 Reset mib\n\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;mwconfig control [start|stop|status|restart] -t &lt;service_name&gt; [OPTIONS]\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    start           Start service\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    stop            Stop service\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    status          Service is started ?\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    restart         Restart the service\n\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;Options :\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -t, --service-name &lt;service_name&gt;   Targeted service name\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -d, --server &lt;tcp://host:port&gt;      Address of the middleware to connect to, default tcp://127.0.0.1:49154 or CHOIR_SERVER_URL env var.\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -a, --application_id &lt;app_id&gt;       Application id to register with.\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -i, --instance &lt;instance_id&gt;        instance id, default 0\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -o, --offline               Only for mwconfig mib, get/set offline mib\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -v                  Be verbose on stderr\n&quot;</span>);</div><div class="line">    printf(<span class="stringliteral">&quot;    -h                  Show this help\n&quot;</span>);</div><div class="line">    exit(1);</div><div class="line">}</div><div class="line"><span class="keyword">enum</span> action { HELP, LISTSERVICES, DUMP, MIB, CONTROL };</div><div class="line"><span class="keyword">enum</span> mib_action { HELP_MIB, SET, GET, GETALL, RESET };</div><div class="line"><span class="keyword">enum</span> control_action { HELP_CONTROL, START, STOP, STATUS, RESTART };</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* <span class="keyword">const</span>* argv)</div><div class="line">{</div><div class="line"></div><div class="line">    <span class="keywordtype">char</span> format[] = <span class="stringliteral">&quot;vhoua:s:i:t:d:&quot;</span>;</div><div class="line">    <span class="keywordtype">int</span> c;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[] = { <span class="comment">/* These options set a flag. */</span></div><div class="line">        { <span class="stringliteral">&quot;verbose&quot;</span>, no_argument, 0, <span class="charliteral">&#39;v&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;help&quot;</span>, no_argument, 0, <span class="charliteral">&#39;h&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;offline&quot;</span>, no_argument, 0, <span class="charliteral">&#39;o&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;application_id&quot;</span>, required_argument, 0, <span class="charliteral">&#39;a&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;server&quot;</span>, required_argument, 0, <span class="charliteral">&#39;d&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;instance&quot;</span>, required_argument, 0, <span class="charliteral">&#39;i&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;service-name&quot;</span>, required_argument, 0, <span class="charliteral">&#39;t&#39;</span> },</div><div class="line">        { <span class="stringliteral">&quot;unescape&quot;</span>, no_argument, 0, <span class="charliteral">&#39;u&#39;</span> },</div><div class="line">        { 0, 0, 0, 0 }</div><div class="line">    };</div><div class="line"></div><div class="line">    choir_socket_handler_t* choir_handler;</div><div class="line">    int64_t application_id = 0;</div><div class="line">    <span class="keywordtype">int</span> offline_flag = 0,service_name_flag = 1;</div><div class="line">    uint32_t i = 0, nbr_extra_args = 0, extra_args_start = 0;</div><div class="line">    int64_t instance_id = 0;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> n = 0; <span class="comment">// error handler</span></div><div class="line">    <span class="keywordtype">char</span> connection_string[256];</div><div class="line">    <span class="keywordtype">char</span> service_name[256];</div><div class="line">    signal(SIGINT, intHandler);</div><div class="line"></div><div class="line">    setDebug(2);</div><div class="line">    <span class="keyword">enum</span> action act = HELP;</div><div class="line">    <span class="keyword">enum</span> mib_action mib_act = HELP_MIB;</div><div class="line">    <span class="keyword">enum</span> control_action ctrl_act = HELP_CONTROL;</div><div class="line">    <span class="keywordtype">char</span>** extra_args = NULL;</div><div class="line">    <span class="keywordtype">char</span>* end = NULL;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> argc_cpy = argc;</div><div class="line">    <span class="keywordtype">char</span>* <span class="keyword">const</span>* argv_offset = argv;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(getenv(<span class="stringliteral">&quot;CHOIR_SERVER_URL&quot;</span>) != NULL){</div><div class="line">        strcpy(connection_string,getenv(<span class="stringliteral">&quot;CHOIR_SERVER_URL&quot;</span>));</div><div class="line">    }<span class="keywordflow">else</span>{</div><div class="line">        strcpy(connection_string, <span class="stringliteral">&quot;tcp://127.0.0.1:49154&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (argc &gt; 1) {</div><div class="line">        <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;list-services&quot;</span>) == 0) {</div><div class="line">            act = LISTSERVICES;</div><div class="line">            argc_cpy -= 1;</div><div class="line">            argv_offset = &amp;argv[1];</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;dump&quot;</span>) == 0) {</div><div class="line">            act = DUMP;</div><div class="line">            argc_cpy -= 1;</div><div class="line">            argv_offset = &amp;argv[1];</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;mib&quot;</span>) == 0) {</div><div class="line">            act = MIB;</div><div class="line">            <span class="keywordflow">if</span>(argc &lt;= 2){</div><div class="line">                print_help();</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;set&quot;</span>) == 0) {</div><div class="line">                mib_act = SET;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;get&quot;</span>) == 0) {</div><div class="line">                mib_act = GET;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;get-all&quot;</span>) == 0) {</div><div class="line">                mib_act = GETALL;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;reset&quot;</span>) == 0) {</div><div class="line">                mib_act = RESET;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                print_help();</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[1], <span class="stringliteral">&quot;control&quot;</span>) == 0) {</div><div class="line">            act = CONTROL;</div><div class="line">            <span class="keywordflow">if</span>(argc &lt;= 2){</div><div class="line">                print_help();</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;start&quot;</span>) == 0) {</div><div class="line">                ctrl_act = START;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;stop&quot;</span>) == 0) {</div><div class="line">                ctrl_act = STOP;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;status&quot;</span>) == 0) {</div><div class="line">                ctrl_act = STATUS;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;restart&quot;</span>) == 0) {</div><div class="line">                ctrl_act = RESTART;</div><div class="line">                argc_cpy -= 2;</div><div class="line">                argv_offset = &amp;argv[2];</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                print_help();</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            print_help();</div><div class="line">            exit(1);</div><div class="line">        }</div><div class="line">        <span class="keywordtype">int</span> inc = 0;</div><div class="line">        <span class="keywordflow">while</span> (1) {</div><div class="line"></div><div class="line">            <span class="comment">/* getopt_long stores the option index here. */</span></div><div class="line">            <span class="keywordtype">int</span> option_index = 0;</div><div class="line">            c = getopt_long(argc_cpy, (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)argv_offset, format, long_options, &amp;option_index);</div><div class="line">            inc ++;</div><div class="line">            <span class="keywordflow">if</span> (c == -1) {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">switch</span> (c) {</div><div class="line"></div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div><div class="line">                setDebug(0);</div><div class="line">                i++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div><div class="line">                print_help();</div><div class="line">                i++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div><div class="line">                instance_id = strtol(optarg, &amp;end, 10);</div><div class="line">                <span class="keywordflow">if</span> (*end){</div><div class="line">                    printf(<span class="stringliteral">&quot;Instance id argument error: %s\n&quot;</span>, end);</div><div class="line">                    exit(1);</div><div class="line">                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(instance_id &lt; INT32_MIN || instance_id &gt; (int64_t)INT32_MAX){</div><div class="line">                    printf(<span class="stringliteral">&quot;Instance id should be comprised between [%&quot;</span>PRId32<span class="stringliteral">&quot;,%&quot;</span>PRId32<span class="stringliteral">&quot;]\n&quot;</span>,INT32_MIN,INT32_MAX);</div><div class="line">                    exit(1);</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    i += 2;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line">                application_id = strtol(optarg, &amp;end, 10);</div><div class="line">                <span class="keywordflow">if</span> (*end){</div><div class="line">                    printf(<span class="stringliteral">&quot;Application id argument error: %s\n&quot;</span>, end);</div><div class="line">                }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(application_id &lt; 0 || application_id &gt; (int64_t)UINT32_MAX){</div><div class="line">                    printf(<span class="stringliteral">&quot;Application id should be comprised between [%u,%&quot;</span>PRIu32<span class="stringliteral">&quot;]\n&quot;</span>,0,UINT32_MAX);</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    i += 2;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line">                strcpy(service_name, optarg);</div><div class="line">                service_name_flag = 1;</div><div class="line">                i += 2;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div><div class="line">                offline_flag = 1;</div><div class="line">                i++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line">                strcpy(connection_string, optarg);</div><div class="line">                i += 2;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        extra_args_start = i + 1;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (extra_args_start &gt; 0) { <span class="comment">// Get extra args</span></div><div class="line"></div><div class="line">            <span class="keywordtype">int</span> j = 0;</div><div class="line">            nbr_extra_args = argc_cpy - extra_args_start;</div><div class="line">            extra_args = (<span class="keywordtype">char</span>**)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*) * nbr_extra_args);</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (i = extra_args_start; i &lt; (uint32_t)argc_cpy; i++) {</div><div class="line">                extra_args[j] = (<span class="keywordtype">char</span>*)argv_offset[i];</div><div class="line">                j++;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(act == LISTSERVICES){</div><div class="line">            choir_handler = <a name="a10"></a><a class="code" href="choir__client_8h.html#ae835e821a4bf02b445aec1494e0101bc">choir_alloc</a>();</div><div class="line">            <span class="keywordflow">if</span>(choir_handler == NULL){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line">            n = <a name="a11"></a><a class="code" href="choir__client_8h.html#a445b813478cca3db6629c5d77429d957">choir_set_timeout</a>(choir_handler, 4000);</div><div class="line">            <span class="keywordflow">if</span>(n){</div><div class="line">                logError(TAG, <span class="stringliteral">&quot;choir_set_timeout failed&quot;</span>);</div><div class="line">                <a name="a12"></a><a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            n = <a name="a13"></a><a class="code" href="choir__client_8h.html#aacaa279568620e9cadde8954740c1bb7">choir_connect</a>(choir_handler, connection_string, application_id);</div><div class="line">            <span class="keywordflow">if</span>(n == -1){</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                <span class="keywordflow">goto</span> connect_error_free;</div><div class="line">            }</div><div class="line"></div><div class="line">            uint32_t nbr_service = 0;</div><div class="line">            <span class="keyword">struct </span><a name="_a14"></a><a class="code" href="structchoir__service__t.html">choir_service_t</a> * service_list;</div><div class="line">            n = choir_list_services(choir_handler, &amp;nbr_service, &amp;service_list);</div><div class="line">            <span class="keywordflow">if</span>(n == 0){</div><div class="line">                <span class="keywordflow">for</span>(i = 0;i &lt; nbr_service;i++){</div><div class="line">                    printf(<span class="stringliteral">&quot;%s[%d] : %s\n&quot;</span>, service_list[i].service_name,</div><div class="line">                                            service_list[i].instance_id,</div><div class="line">                                            config_status_to_str(service_list[i].status));</div><div class="line">                }</div><div class="line">                choir_free_service_list(nbr_service,&amp;service_list);</div><div class="line">            }</div><div class="line">            <a name="a15"></a><a class="code" href="choir__client_8h.html#ad162141a2b0123c0b2f3a31d4d0c32f1">choir_disconnect</a>(choir_handler);</div><div class="line">            <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (act == DUMP){</div><div class="line">            <span class="keyword">struct </span>choir_map* mib;</div><div class="line">            choir_handler = <a class="code" href="choir__client_8h.html#ae835e821a4bf02b445aec1494e0101bc">choir_alloc</a>();</div><div class="line">            <span class="keywordflow">if</span>(choir_handler == NULL){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#a445b813478cca3db6629c5d77429d957">choir_set_timeout</a>(choir_handler, 4000);</div><div class="line">            <span class="keywordflow">if</span>(n){</div><div class="line">                logError(TAG, <span class="stringliteral">&quot;choir_set_timeout failed&quot;</span>);</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#aacaa279568620e9cadde8954740c1bb7">choir_connect</a>(choir_handler, connection_string, application_id);</div><div class="line">            <span class="keywordflow">if</span>(n == -1){</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                <span class="keywordflow">goto</span> connect_error_free;</div><div class="line">            }</div><div class="line"></div><div class="line">            printf(<span class="stringliteral">&quot;list services connect : %s app %d\n&quot;</span>,connection_string,(<span class="keywordtype">int</span>)application_id);</div><div class="line">            uint32_t nbr_service = 0;</div><div class="line">            <span class="keyword">struct </span><a class="code" href="structchoir__service__t.html">choir_service_t</a> * service_list;</div><div class="line">            n = choir_list_services(choir_handler, &amp;nbr_service, &amp;service_list);</div><div class="line">            <span class="keywordflow">if</span>(n == 0){</div><div class="line">                <span class="keywordflow">for</span>(i = 0;i &lt; nbr_service;i++){</div><div class="line">                    printf(<span class="stringliteral">&quot;%s[%d] : %s\n&quot;</span>, service_list[i].service_name,</div><div class="line">                                            service_list[i].instance_id,</div><div class="line">                                            config_status_to_str(service_list[i].status));</div><div class="line">                    mib = choir_mib_get_all(choir_handler, (service_list)[i].service_name, (service_list)[i].instance_id, offline_flag);</div><div class="line">                    <span class="keywordflow">if</span>(mib != NULL){</div><div class="line">                        <a name="a16"></a><a class="code" href="choir__client_8h.html#a8481c794e434d1808fab6ef04c2dd162">choir_map_print</a>(mib);</div><div class="line">                        <a class="code" href="choir__client_8h.html#a46a1ae74e3f6a9a41da2690a6fc3ea62">choir_map_free</a>(mib);</div><div class="line">                    }<span class="keywordflow">else</span>{</div><div class="line">                        printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                choir_free_service_list(nbr_service,&amp;service_list);</div><div class="line">            }</div><div class="line">            <a class="code" href="choir__client_8h.html#ad162141a2b0123c0b2f3a31d4d0c32f1">choir_disconnect</a>(choir_handler);</div><div class="line">            <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(act ==  MIB){</div><div class="line">            <span class="keyword">struct </span>choir_map* mib;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span>(service_name_flag == 0){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line">            choir_handler = <a class="code" href="choir__client_8h.html#ae835e821a4bf02b445aec1494e0101bc">choir_alloc</a>();</div><div class="line">            <span class="keywordflow">if</span>(choir_handler == NULL){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#a445b813478cca3db6629c5d77429d957">choir_set_timeout</a>(choir_handler, 4000);</div><div class="line">            <span class="keywordflow">if</span>(n){</div><div class="line">                logError(TAG, <span class="stringliteral">&quot;choir_set_timeout failed&quot;</span>);</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#aacaa279568620e9cadde8954740c1bb7">choir_connect</a>(choir_handler, connection_string, application_id);</div><div class="line">            <span class="keywordflow">if</span>(n == -1){</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                <span class="keywordflow">goto</span> connect_error_free;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">switch</span> (mib_act) {</div><div class="line">            <span class="keywordflow">case</span> SET: <span class="comment">//MIB</span></div><div class="line">                <span class="keywordflow">if</span> (nbr_extra_args &gt; 0) {</div><div class="line">                    FILE* pFile;</div><div class="line">                    pFile = tmpfile();</div><div class="line">                    <span class="keywordflow">for</span> (i = 0; i &lt; nbr_extra_args; i++) {</div><div class="line">                        fputs(extra_args[i], pFile);</div><div class="line">                        fputs(<span class="stringliteral">&quot;\n&quot;</span>, pFile);</div><div class="line">                    }</div><div class="line">                    fputc(EOF, pFile);</div><div class="line">                    rewind(pFile);</div><div class="line">                    set_mib(choir_handler, pFile,  service_name, instance_id, offline_flag);</div><div class="line">                    fclose(pFile);</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    <span class="keywordflow">goto</span> args_error_free;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> GET:</div><div class="line">                mib = choir_mib_get(choir_handler, service_name, instance_id, offline_flag, nbr_extra_args, extra_args);</div><div class="line">                <span class="keywordflow">if</span>(mib != NULL){</div><div class="line">                    <a class="code" href="choir__client_8h.html#a8481c794e434d1808fab6ef04c2dd162">choir_map_print</a>(mib);</div><div class="line">                    <a class="code" href="choir__client_8h.html#a46a1ae74e3f6a9a41da2690a6fc3ea62">choir_map_free</a>(mib);</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> GETALL:</div><div class="line">                mib = choir_mib_get_all(choir_handler, service_name, instance_id, offline_flag);</div><div class="line">                <span class="keywordflow">if</span>(mib != NULL){</div><div class="line">                    <a class="code" href="choir__client_8h.html#a8481c794e434d1808fab6ef04c2dd162">choir_map_print</a>(mib);</div><div class="line">                    <a class="code" href="choir__client_8h.html#a46a1ae74e3f6a9a41da2690a6fc3ea62">choir_map_free</a>(mib);</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> RESET:</div><div class="line">                <span class="keywordflow">if</span>(choir_mib_reset(choir_handler, service_name , instance_id,offline_flag) != 0){</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> HELP_MIB:</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <a class="code" href="choir__client_8h.html#ad162141a2b0123c0b2f3a31d4d0c32f1">choir_disconnect</a>(choir_handler);</div><div class="line">            <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(act == CONTROL){</div><div class="line">            <span class="keywordflow">if</span>(service_name_flag == 0){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line"></div><div class="line">            choir_handler = <a class="code" href="choir__client_8h.html#ae835e821a4bf02b445aec1494e0101bc">choir_alloc</a>();</div><div class="line">            <span class="keywordflow">if</span>(choir_handler == NULL){</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#a445b813478cca3db6629c5d77429d957">choir_set_timeout</a>(choir_handler, 4000);</div><div class="line">            <span class="keywordflow">if</span>(n){</div><div class="line">                logError(TAG, <span class="stringliteral">&quot;choir_set_timeout failed&quot;</span>);</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                exit(1);</div><div class="line">            }</div><div class="line">            n = <a class="code" href="choir__client_8h.html#aacaa279568620e9cadde8954740c1bb7">choir_connect</a>(choir_handler, connection_string, application_id);</div><div class="line">            <span class="keywordflow">if</span>(n == -1){</div><div class="line">                <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">                <span class="keywordflow">goto</span> connect_error_free;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">switch</span> (ctrl_act) {</div><div class="line">            <span class="keywordflow">case</span> START: <span class="comment">//Control</span></div><div class="line">                <span class="keywordflow">if</span>(choir_service_start(choir_handler, service_name , instance_id) != 0){</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> STOP:</div><div class="line">                <span class="keywordflow">if</span>(<a name="a17"></a><a class="code" href="choir__client_8h.html#aca098b810fd83e021722b5c42a610fbf">choir_service_stop</a>(choir_handler, service_name , instance_id) != 0){</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> STATUS:</div><div class="line">                n = choir_service_fullstatus(choir_handler, service_name , instance_id);</div><div class="line">                <span class="keywordflow">if</span> (n &lt; 0) {</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    <span class="keywordflow">switch</span> (n) {</div><div class="line">                    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_UNKNOWN:</div><div class="line">                        printf(<span class="stringliteral">&quot;Service status is unknown\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_STARTED:</div><div class="line">                        printf(<span class="stringliteral">&quot;Service is started\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_STOPPED:</div><div class="line">                        printf(<span class="stringliteral">&quot;Service is stopped\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    <span class="keywordflow">case</span> CONFIG_SERVICE_STATUS_FAILED:</div><div class="line">                        printf(<span class="stringliteral">&quot;Service is failed\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    <span class="keywordflow">default</span>:</div><div class="line">                        printf(<span class="stringliteral">&quot;error : Invalid service status\n&quot;</span>);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> RESTART:</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="choir__client_8h.html#aca098b810fd83e021722b5c42a610fbf">choir_service_stop</a>(choir_handler, service_name , instance_id) != 0){</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span>(choir_service_start(choir_handler, service_name , instance_id) != 0){</div><div class="line">                    printf(<span class="stringliteral">&quot;error : %s\n&quot;</span>,<a class="code" href="choir__client_8h.html#acaf4cf88458c53c32e63661ec25b03d2">choir_get_last_error</a>(choir_handler));</div><div class="line">                }</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            <span class="keywordflow">case</span> HELP:</div><div class="line">            <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">goto</span> args_error_free;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <a class="code" href="choir__client_8h.html#ad162141a2b0123c0b2f3a31d4d0c32f1">choir_disconnect</a>(choir_handler);</div><div class="line">            <a class="code" href="choir__client_8h.html#a70ed7698338e2d7e81997d29090290f9">choir_free</a>(choir_handler);</div><div class="line">        }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (act == HELP){</div><div class="line">            <span class="keywordflow">goto</span> args_error_free;</div><div class="line">        }</div><div class="line"></div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordflow">goto</span> args_error_free;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    free(extra_args);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">    args_error_free:</div><div class="line">    print_help();</div><div class="line">    connect_error_free:</div><div class="line">    free(extra_args);</div><div class="line">    exit(1);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Tue Mar 14 2023 16:13:27 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="yogoko-doxy.js"></script>
  </body>
</html>
