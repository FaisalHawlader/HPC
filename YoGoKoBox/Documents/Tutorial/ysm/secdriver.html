<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Security Driver</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="yogoko.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="https://www.yogoko.com/"><img height="40px" src="yogoko-logo-svg-fr-white.png" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">YoGoKo Smart Middleware</span></p>
              <ul id="yogoko-navlist" class="nav navbar-nav"></ul>
              <form id="yogoko-searchform" class="navbar-form navbar-left navbar-right hidden-sm hidden-xs">
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" id="MSearchField" placeholder="" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('secdriver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Security Driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p>The <b>Security Driver</b> provides an abstraction to integrate several Hardware Security Modules, cryptographic accelerators, or other libraries enabling security operations.</p>
<p>It consists in a security library supporting several drivers, a Security Driver service which responds to security operations requests, and a NVM Unlock service which allows to unlock some Hardware Security Modules.</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_4.png" alt="dot_inline_dotgraph_4.png" border="0" usemap="#dot_inline_dotgraph_4.map"/>
<map name="dot_inline_dotgraph_4.map" id="dot_inline_dotgraph_4.map"></map>
</div>
<h2>Supported security operations</h2>
<p>The <b>Security Driver</b> supports the following operations:</p><ul>
<li>ECDSA signature</li>
<li>ECDSA verification</li>
<li>ECIES encryption</li>
<li>ECIES decryption</li>
<li>AES CCM operations</li>
<li>Hashing</li>
<li>RNG</li>
</ul>
<h2>Supported curves</h2>
<p>The <b>Security Driver</b> supports the following elliptic curves:</p><ul>
<li>NIST 256</li>
<li>NIST 384</li>
<li>Brainpool 256</li>
<li>Brainpool 384r1</li>
<li>Brainpool 384t1</li>
</ul>
<h1>Features</h1>
<h2>Security Driver library</h2>
<p>The Security Driver library (<em><b>libsecdriver</b></em>) allows application or daemons to access to security operations (signature, verification, encryption, decryption). Security operations are integrated in the library, providing to applications an abstracted way to access to the underlying security hardware or software crypto library, via a common API.</p>
<p>Hardware Security Modules or crypto accelerators are integrated in the library as "drivers". So far, the following drivers are implemented:</p><ul>
<li><em><b>null</b></em>: This driver is a null implementation which returns a failure to all operations. This allows to stub the security driver when needed.</li>
<li><em><b>openssl</b></em>: This driver performs security operations with the openssl crypto library (<em><b>libcrypto</b></em>). Private keys are stored on the local storage.</li>
<li><em><b>atlk</b></em>: This driver performs security operations with the HSM present on the Autotalks CRATON 1 platform (through the Autotalks SDK). The driver atlk is present only in the Autotalks build of the library.</li>
<li><em><b>remote</b></em>: This driver performs security operations with the Security Driver service. Requests are sent over the publish-subscribe mechanism to the Security Driver service, which performs the operation with the security driver currently is use. In particular, this service allows to perform security operations with the Autotalks CRATON 1 HSM, from a Linux daemon located on the host.</li>
</ul>
<h2>Security Driver service</h2>
<p>The Security Driver service provides a remote access to security operations, through the middleware publish-subscribe mechanism.</p>
<p>At its startup, the Security Driver service registers to a message id (default 191) and listens for incoming requests. On reception of a pubsub request, it performs the operation and returns the result as the response to the request. The communication may be encrypted if the client initializes an encrypted session.</p>
<p>In order to perform operations, the Security Driver uses an underlying driver from the Security Driver library.</p>
<p>The Security Driver service may be executed as a POSIX daemon (<em><b>itssecdrvd</b></em>) or as part of YoGoKo Autotalks service.</p>
<h2>NVM Unlock service</h2>
<p>In order to ensure a complete tamper-protection over the system, some HSM are protected with a master key. This master key is used to encrypt the HSM NVM and is required to unlock HSM operations.</p>
<p>The NVM Unlock service is meant to retrieve and provide the master key to the HSM.</p>
<p>Two major operations are performed by the NVM Unlock service:</p><ul>
<li><b>HSM reset</b>: This operation consists in resetting the HSM NVM. The HSM memory is erased and all private keys are lost. A new master key is generated, which is stored on the protected memory for later unlocking.</li>
<li><b>HVM unlock</b>: This operation consists in unlocking the HSM NVM. The master key is transmitted to the HSM to decrypt its memory, unlocking access to private key operations.</li>
</ul>
<p>In the current implementation, the NVM Unlock service stores and retrieves the master key by issuing a I2C read on a tamper-protected memory. For now, only the tamper-protected memory of Gateworks Ventana hardware platforms is supported for the storage of the master key.</p>
<h1>Running the Security Driver service</h1>
<h2>As a Linux daemon</h2>
<p><b>Using systemd</b></p>
<p>Systemd service management has not been implemented yet.</p>
<p><b>Manually</b></p>
<p>Using the openssl driver (with private key storage in <em><b>/tmp/keys/</b></em>):</p>
<p><code># itssecdrvd -d tcp://127.0.0.1:49154 -a 296 -u 297 -m 190 -p 193 -H openssl --openssl-privkeys-path /tmp/keys/</code></p>
<p>Note: The <em><b>/tmp/keys/</b></em> folder must exist and be empty (or issued from a previous execution of the Security Driver).</p>
<p>The following command-line arguments are accepted:</p><ul>
<li>'-d' or '&ndash;destination' specify the address of the middleware to connect to (tcp://&lt;host&gt;:&lt;port&gt;)</li>
<li>'-a' or '&ndash;appid' specify the application id of the security driver service</li>
<li>'-m' or '&ndash;msgid' specify the message id of the security driver security</li>
<li>'-u' or '&ndash;unlockreq_appid' specify the application id for publishing unlock requests</li>
<li>'-p' or '&ndash;unlockreq_msgid' specify the message id to publish unlock requests</li>
<li>'-H' or '&ndash;hsm-driver' specify the hsm driver to use</li>
<li>'&ndash;openssl-privkeys-path' specify the path for private key storage with the openssl driver</li>
<li>'&ndash;openssl-secure-storage' specify whether the storage should be unlocked with the openssl driver</li>
<li>'-h' or '&ndash;help' display this help</li>
<li>'-v' or '&ndash;verbose' verbose mode (print successful steps)</li>
<li>'-V' or '&ndash;version' show program version information</li>
</ul>
<p>A full list of arguments is provided when providing the option '-h'.</p>
<h2>As an Autotalks thread</h2>
<p>The <b>Security Driver</b> service is integrated in ThreadX images provided by YoGoKo for Autotalks Craton1 platforms. The service is controlled by <b>secdrv.</b> configuration parameters.</p>
<p>The execution of the <b>Security Driver</b> service may be controlled in the <b>AutotalksServices</b> configuration with the <em><b>secdrv.enabled</b></em> variable:</p><ul>
<li>When <em><b>secdrv.enabled</b></em> is set (1), the <b>Security Driver</b> service is started with appids and msgids provided in its configuration (or the defaut values if not provided)</li>
<li>When <em><b>secdrv.enabled</b></em> is set (0), the <b>Security Driver</b> service is not started</li>
</ul>
<p>The <b>Security Driver</b> service on Autotalks reports the statistics of the HSM driver on MIB GET requests.</p>
<h1>Running the NVM Unlock service</h1>
<p>The NVM Unlock service only exists as a Linux daemon (<em><b>itsnvmunlockd</b></em>).</p>
<p><b>Using systemd</b></p>
<p>Start itsnvmunlockd:</p>
<p><code>$ systemctl start itsnvmunlockd</code></p>
<p>Stop itsnvmunlockd:</p>
<p><code>$ systemctl stop itsnvmunlockd</code></p>
<p>Restart itsnvmunlockd:</p>
<p><code>$ systemctl restart itsnvmunlockd</code></p>
<p>Verify status:</p>
<p><code>$ systemctl status itsnvmunlockd</code></p>
<p><b>Manually</b></p>
<p>Resetting the HSM NVM and generating a master key:</p>
<p><code>$ itsnvmunlockd -d tcp://127.0.0.1:49154 -a 292 -p 190 --resethsm --newkeys</code></p>
<p>Unlocking the HSM:</p>
<p><code>$ itsnvmunlockd -d tcp://127.0.0.1:49154 -a 292 -u 293 -p 190 -s 193 -l</code></p>
<p>The following command-line arguments are accepted:</p><ul>
<li>'-k' or '&ndash;key' specify the unlock key as an argument (for testing purposes, no i2c communications)</li>
<li>'-d' or '&ndash;destination' specify the address of the middleware to connect to (tcp://&lt;host&gt;:&lt;port&gt;)</li>
<li>'-a' or '&ndash;appid1' specify the application id of the sending thread</li>
<li>'-u' or '&ndash;appid2' specify the application id of the receiver thread</li>
<li>'-p' or '&ndash;pubmsgid' specify the message id to publish to (corresponds to the 'm' argument of itssecdrvd)</li>
<li>'-s' or '&ndash;submsgid' specify the message id to subscribe to (corresponds to the 'p' argument of itssecdrvd)</li>
<li>'-l' or '&ndash;loop' loop and listen to unlock commands from choir</li>
<li>'-h' or '&ndash;help' display this help</li>
<li>'-v' or '&ndash;verbose' verbose mode (print successful steps)</li>
<li>'-V' or '&ndash;version' show program version information</li>
<li>'&ndash;newkeys' generate a new pair of hsm master keys</li>
<li>'&ndash;resethsm' reset hsm NVM memory</li>
</ul>
<p>A full list of arguments is provided when providing the option '-h'. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Tue Mar 14 2023 16:13:25 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.13</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="yogoko-doxy.js"></script>
  </body>
</html>
